import{P as e,j as s,r as l,S}from"./index-DnSvBsN8.js";import{a as h,l as v}from"./sleeperApi-BE8q_8nq.js";import{u as E}from"./useFetchPlayers-DPyeBxHR.js";import{P as L}from"./PageHeader-Y3u8qxoU.js";const P=({pick:t,players:i,teams:n})=>{var d;const a=i[t.player_id],o=a?`${a.first_name} ${a.last_name}`:"unknown",r=((d=t.metadata)==null?void 0:d.team)||"unknown team",c=n[t.roster_id];return s.jsxs("li",{className:"pick-selection",children:[s.jsxs("p",{className:"pick-details",children:[a.position," - ",r," ",t.round,".",t.pick_no]}),s.jsx("img",{src:`https://sleepercdn.com/content/nfl/players/${t.player_id}.jpg`,className:"player-image"}),s.jsx("p",{className:"drafted-player-name",children:o}),s.jsx("p",{className:"team-drafting",children:c})]})};P.propTypes={pick:e.shape({player_id:e.string.isRequired,metadata:e.shape({team:e.string}),round:e.number.isRequired,pick_no:e.number.isRequired,roster_id:e.number.isRequired}).isRequired,players:e.objectOf(e.shape({first_name:e.string,last_name:e.string,position:e.string})).isRequired,teams:e.objectOf(e.string).isRequired};const b=()=>{const[t,i]=l.useState([]),[n,a]=l.useState({}),[o,r]=l.useState(!0),[c,d]=l.useState(null),{players:f,loading:u,error:g}=E();return l.useEffect(()=>{!u&&!g&&(async m=>{let p=m,x=[],_={};for(;p;)try{const j=await h.get(`https://api.sleeper.app/v1/league/${p}/drafts`);x=[...x,...j.data];const N=(await h.get(`https://api.sleeper.app/v1/league/${p}/users`)).data;(await h.get(`https://api.sleeper.app/v1/league/${p}/rosters`)).data.forEach(D=>{const k=N.find(q=>q.user_id===D.owner_id);k&&(_[D.roster_id]=k.display_name)}),p=(await h.get(`https://api.sleeper.app/v1/league/${p}`)).data.previous_league_id}catch(j){console.error("Error fetching league data:",j),d(j),r(!1);break}i(x),a(_),r(!1)})(v)},[u,g]),{drafts:t,players:f,teams:n,loading:o,error:c}},w=()=>{const[t,i]=l.useState([]),[n,a]=l.useState(null),[o,r]=l.useState(!1),[c,d]=l.useState(!0),[f,u]=l.useState(null);return{draftPicks:t,selectedDraftId:n,display:o,fetchDraftPicks:async y=>{if(n===y){a(null),i([]),r(!1);return}try{const m=await h.get(`https://api.sleeper.app/v1/draft/${y}/picks`);i(m.data),a(y),r(!0)}catch(m){u("error fetching picks",m)}finally{d(!1)}},picksLoading:c,picksError:f}},R=({draft:t,players:i,teams:n})=>{const{draftPicks:a,selectedDraftId:o,display:r,fetchDraftPicks:c,loading:d,error:f}=w();return d?s.jsx("div",{children:"Loading..."}):f?s.jsx("div",{children:"Error loading data"}):s.jsxs("li",{className:"draft-li",children:[s.jsx("p",{className:"drafts-season",children:t.season}),s.jsx("button",{className:"display-draft-btn",onClick:()=>c(t.draft_id),children:r?"hide draft":"show draft"}),o===t.draft_id&&a.length>0?s.jsx("div",{className:"draft",children:s.jsx("ul",{className:"draft-results-grid",children:a.map((u,g)=>s.jsx(P,{pick:u,players:i,teams:n},g))})}):null]})};R.propTypes={draft:e.shape({season:e.string.isRequired,draft_id:e.string.isRequired}).isRequired,players:e.objectOf(e.shape({first_name:e.string,last_name:e.string,position:e.string})).isRequired,teams:e.objectOf(e.string).isRequired};const A=()=>{const{drafts:t,players:i,teams:n,loading:a,error:o}=b();return a?s.jsx(S,{}):o?s.jsx("div",{children:"Error loading data"}):s.jsxs("div",{className:"drafts-container",children:[s.jsx(L,{pageTitle:"Draft History"}),t.length>0?s.jsx("ul",{className:"draft-season-section",children:t.map((r,c)=>s.jsx(R,{draft:r,players:i,teams:n},c))}):s.jsx("p",{children:"Drafts still loading"})]})};export{A as default};
